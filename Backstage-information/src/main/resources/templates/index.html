<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>司机信息</title>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
          crossorigin="anonymous">
    <!--jquery-->
    <script src="/static/jquery-3.4.1.js" type="text/javascript"></script>
    <!--bootstrap.js-->
    <link rel="script" href="/static/bootstrap.js">
    <!--<script src="/static/bootstrap.js" type="text/javascript" charset="utf-8"></script>-->
    <link rel="stylesheet" href="/static/textcc.css">

    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <!--导入vue组件-->
    <script src="/static/vue.js" charset="utf-8" type="text/javascript"></script>

    <!--<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"/ >-->

    <!--解决弹窗问题-->
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>

</head>
<body>
<!-- 浮动Modal -->
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <form class="form-inline">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">修改信息</h4>
                </div>
                <div class="modal-body ">
                    <div class="form-group">
                        <label for="zbqDeviceID">ID:</label>
                        <input type="text" name="zbqDeviceID" class="form-control" id="zbqDeviceID" disabled>
                    </div>
                    <div class="form-group">
                        <label for="zbqDeviceDriverName">司机姓名:</label>
                        <input type="text" class="form-control" id="zbqDeviceDriverName" disabled>
                    </div>
                    <div class="form-group">
                        <label for="zbqDeviceMobile">电话:</label>
                        <input type="text" class="form-control" id="zbqDeviceMobile" disabled>
                    </div>
                    <div class="form-group">
                        <label for="zbqDeviceCarNumber">车牌号码:</label>
                        <input type="text" class="form-control" id="zbqDeviceCarNumber" disabled>
                    </div>
                    <div class="form-group">
                        <label for="zbqDeviceOnlineTime">当月时长:</label>
                        <input type="text" class="form-control" id="zbqDeviceOnlineTime" disabled>
                    </div>
                    <div class="form-group">
                        <label for="iccid">ICCID:</label>
                        <input type="text" name="driverIccid" class="form-control" id="iccid">
                    </div>
                    <div class="form-group" style="width: 100%; margin-top: 10px">
                        <label for="deviceNote">备注信息:</label>
                        <textarea class="form-control" name="iccidTraffic" style="width: 70%" rows="3" id="deviceNote"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" id="qx" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="bcxx">保存</button>
                </div>
            </div>
        </form>
    </div>
</div>
<div class="container">
    <h2 class="text-center">数据信息展示</h2>
    <form class="form-inline" th:action="@{/searchDriver}">
        <div class="form-group">
            <label for="exampleInputName2">姓名:</label>
            <input type="text" class="form-control" id="exampleInputName2" name="driverName" placeholder="请输入要查询的姓名！">
        </div>
        <div class="form-group">
            <label for="exampleInputName3">电话:</label>
            <input type="text" class="form-control" id="exampleInputName3" name="driverPhone" placeholder="请输入要查询的电话！">
        </div>
        <div class="form-group">
            <label for="exampleInputName4">车牌:</label>
            <input type="text" class="form-control" id="exampleInputName4" name="driverPlateNum" placeholder="请输入要查询的车牌！">
        </div>
        <button type="submit" class="btn btn-primary">查询</button>
    </form>
    <br/>
    <table class="table table-striped table-hover table-condensed ">
        <tr id="app" style="font-size: 10px">
            <th>ID</th>
            <th>姓名</th>
            <th>电话</th>
            <th>车牌</th>
            <th>当月/H
                <button name="onlineTime" id="dangyue" class="glyphicon glyphicon-minus"/>
            </th>
            <th>平均/H
                <button name="pjsj" id="meitian" class="glyphicon glyphicon-minus"/>
            </th>
            <th>登录时间
                <button name="lastLoginTime" id="denglu" class="glyphicon glyphicon-minus"/>
            </th>
            <th>上报时间
                <button name="lastReportTime" id="shangbao" class="glyphicon glyphicon-minus"/>
            </th>
            <th>安装时间
                <button name="recordTime" id="anzhuang" class="glyphicon glyphicon-minus"/>
            </th>
            <th>ICCID</th>
            <th>SIM卡状态</th>
            <th>已用流量</th>
            <th>备注信息</th>
            <th>操作</th>
        </tr>
        <tr th:each="extendDevice : ${extendDevices}" style="font-size: 10px">
            <td th:text="${extendDevice?.zbqDevice?.id}">11</td>
            <td th:text="${extendDevice?.zbqDevice?.driverName}">11</td>
            <td th:text="${extendDevice?.zbqDevice?.mobile}">11</td>
            <td th:text="${extendDevice?.zbqDevice?.carNumber}">11</td>
            <td th:text="${extendDevice?.zbqDevice?.onlineTime}">11</td>
            <td th:text="${extendDevice?.zbqDevice?.pjsj}">11</td>
            <td th:text="${extendDevice?.zbqDevice?.lastLoginTime}">11</td>
            <td th:text="${extendDevice?.zbqDevice?.lastReportTime}">11</td>
            <td th:text="${extendDevice?.zbqDevice?.recordTime}">111</td>
            <td th:class="iccid" th:text="${extendDevice?.extendInformation?.deviceIccid}"></td>
            <td th:id="${extendDevice?.extendInformation?.deviceIccid}+'state'" th:text="${extendDevice?.extendInformation?.iccidState}">11</td>
            <td th:id="${extendDevice?.extendInformation?.deviceIccid}+'traffic'" th:text="${extendDevice?.extendInformation?.iccidTraffic != null} ? ${extendDevice?.extendInformation?.iccidTraffic}+'MB' : '' ">11</td>
            <td>
                <a tabindex="0" th:text="${extendDevice?.extendInformation?.deviceNote != null} ? '点击获取信息' : '无备注信息'" role="button" data-html="true" data-toggle="popover" data-placement="top"
                   data-trigger="focus" title="备注信息:"
                   th:data-content="${extendDevice?.extendInformation?.deviceNote}">可消失的弹出框</a>
            </td>
            <td>
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-primary button-textUpdate" data-toggle="modal" th:name="${extendDevice?.zbqDevice.id}" style="padding: 0px 4px;font-size: 10px"
                        data-target="#myModal">
                    修改
                </button>
            </td>
        </tr>
    </table>
    <nav aria-label="Page navigation">
        <ul class="pagination">
            <!-- 首页 -->
            <li>
                <a th:href="@{/hello1(page=1)}">首页</a>
            </li>
            <!-- 上一页 -->
            <li th:if="${page>1}">
                <a th:href="@{/hello1(page=${page}-1)}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li th:if="${page}- 2 >0"><a th:href="@{/hello1(page=${page}-2)}" th:text="${page}-2">1</a></li>
            <li th:if="${page}- 1 >0"><a th:href="@{/hello1(page=${page}-1)}" th:text="${page}-1">2</a></li>
            <li th:if="${page}"><a th:href="@{/hello1(page=${page})}" th:text="${page}">3</a></li>
            <li th:if="${page}+ 1 < ${lenght}"><a th:href="@{/hello1(page=${page}+1)}" th:text="${page}+1">2</a></li>
            <li th:if="${page}+ 2 < ${lenght}"><a th:href="@{/hello1(page=${page}+2)}" th:text="${page}+2">2</a></li>
            <!-- 下一页 -->
            <li th:if="${page}<${lenght}">
                <a th:href="@{/hello1(page=${page}+1)}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
            <!-- 尾页 -->
            <li>
                <a th:href="@{/hello1(page=${lenght})}">尾页</a>
            </li>
            <li><a th:text="当前第+${page}+页"></a></li>
        </ul>


    </nav>
</div>
</body>

<script>
    // var vm = new Vue({
    //     el: "#app",
    //     data: {
    //         default: 'glyphicon glyphicon-minus',
    //         ase: "glyphicon glyphicon-triangle-top",
    //         reverse: "glyphicon glyphicon-triangle-bottom"
    //     },
    //     create : function () {
    //         this.getZbqDevices('','');
    //     },
    //     methods: {
    //         getZbqDevices : function (str1, str2) {
    //             $.ajax({
    //                 url: '/hello1' + '?name=' + str1 + 'type=' + str2,
    //                 type: "get",
    //                 dataType: 'json',
    //                 success: function(json) {
    //                     console.log(json.toString());
    //                 }
    //             });
    //         }
    //
    //     }
    // })

    // $(function () {
    //     getZbqDevices();

    //     function getZbqDevices() {
    //         $.ajax({
    //             url: 'http://localhost:8080/hello1',
    //             type: "get",
    //             dataType: 'json',
    //             data: '',
    //             success: function (data) {
    //                 for (var o in data) {
    //                     var id = data[o].id;
    //                     var driverName = data[o].driverName;
    //                     var mobile = data[o].mobile;
    //                     var carNumber = data[o].carNumber;
    //                     var onlineTime = data[o].onlineTime;
    //                     var pjsj = data[o].pjsj;
    //                     var lastLoginTime = data[o].lastLoginTime;
    //                     var lastReportTime = data[o].lastReportTime;
    //                     var recordTime = data[o].recordTime;
    //                     $('tbody').append(
    //                         ' <tr  style="font-size: 10px">\n' +
    //                         '            <td>' + id + '</td>' +
    //                         '            <td>' + driverName + '</td>\n' +
    //                         '            <td >' + mobile + '</td>\n' +
    //                         '            <td>' + carNumber + '</td>\n' +
    //                         '            <td >' + onlineTime + '</td>\n' +
    //                         '            <td >' + pjsj + '</td>\n' +
    //                         '            <td >' + lastLoginTime + '1</td>\n' +
    //                         '            <td >' + lastReportTime + '</td>\n' +
    //                         '            <td >' + recordTime + '</td>\n' +
    //                         '            <td ></td>\n' +
    //                         '            <td >11</td>\n' +
    //                         '            <td >11</td>\n' +
    //                         '            <td></td>\n' +
    //                         '            <td>\n ' +
    //                         '                <button type="button" class="btn btn-primary" data-toggle="modal" onclick="xg(this)" name="' + id + '" style="padding: 0px 4px" data-target="#myModal">\n' +
    //                         '                    修改\n' +
    //                         '                </button>\n' +
    //                         '            </td>\n' +
    //                         '</tr>'
    //                     )
    //                 }
    //
    //             }
    //         });
    //     }
    //
    // });


    $(".btn-default").click(function () {
        // console.log("112222");
    });

    function xg(obj) {
        // console.log($(obj).attr("name"));
        // console.log("1111111");
    }

    $(".button-textUpdate").click(function () {

        $("body").css("padding-right", "0px");

        var id = $(this).attr('name');
        console.log(id);
        $.ajax({
            url: '/getDriver?id=' + id,
            type: 'get',
            dataType: 'json',
            data: '',
            success: function (data) {
                $("#zbqDeviceID").val(data.zbqDevice.id);
                $("#zbqDeviceDriverName").val(data.zbqDevice.driverName);
                $("#zbqDeviceMobile").val(data.zbqDevice.mobile);
                $("#zbqDeviceCarNumber").val(data.zbqDevice.carNumber);
                $("#zbqDeviceOnlineTime").val(data.zbqDevice.onlineTime + "(小时)");
                $("#iccid").val(data.extendInformation.deviceIccid);
                $("#deviceNote").val(data.extendInformation.deviceNote);
            }
        });
    })

    $("#bcxx").click(function () {
        var id = $("#zbqDeviceID").val();
        var iccid = $("#iccid").val();
        var deviceNote = $("#deviceNote").val();
        var state = "保存失败";
        $.ajax({
            url: '/saveEI?id=' + id + '&driverIccid=' + iccid + '&deviceNote=' + deviceNote,
            type: "POST",
            dataType: 'json',
            data: '',
            success: function (data) {
                if (data == 1) {
                    state = "保存成功";
                }
                alert(state);
                // window.location.href = "/hello1";


            }

        })
    });

    function getDriver(id) {
        $.ajax({
            url: '/getDriver?id=' + id,
            type: 'get',
            dataType: 'json',
            data: '',
            success: function (data) {
                return data
            }
        });
    }

    $(".css1").click(function () {

    });

    $(function () {
        $("[data-toggle='popover']").popover();
    });

    // $(function () {
    //
    //     var iccids = new Array();
    //
    //     $.ajax({
    //         url: '/getIccids',
    //         type: 'GET',
    //         dataType: 'json',
    //         data: '',
    //         success: function (data) {
    //             iccids = data;
    //         }
    //     });
    //
    //
    //     for (var i = 0; i < iccids.length; i++) {
    //         console.log(iccids[i])
    //         $.ajax({
    //             url: 'https://api.10646.cn/rws/api/v1/devices/' + iccids[i] + '/ctdUsages',
    //             type: 'GET',
    //             dataType: 'json',
    //             data: '',
    //             success: function (data) {
    //                 $("#iccids[i]+state").val(data.status)
    //                 $("#iccids[i]+traffic").val(data.ctdDataUsage);
    //             }
    //         });
    //     }
    //
    // });

    // $(function () {
    //     var iccid = "89860619050012707401";
    //     $.ajax({
    //         url: 'https://api.10646.cn/rws/api/v1/devices/' + iccid + '/ctdUsages',
    //         type: 'GET',
    //         dataType: 'jsonp',
    //         jsonp: 'callback',
    //         data : '',
    //         jsonpCallback:"success_jsonpCallback",
    //         success: function (data) {
    //             console.log("测试111");
    //             console.log(data.toString());
    //             $("#89860619050012707401state").text(data.status);
    //             $("#89860619050012707401traffic").text(data.ctdDataUsage);
    //         }
    //     });
    // });


    $(".iccid").click(function () {
        var iccid = $(this).text();
        var iccidState = iccid+'state';
        var iccidTraffic = iccid+'traffic';
        $.ajax({
            url: '/getIccidMsg?iccid='+iccid,
            type: 'GET',
            dataType: 'json',
            data: '',
            success: function (data) {
                $("#"+iccidState).text(data.status);
                $("#"+iccidTraffic).text(data.ctdDataUsage+"MB");
            }
        });
    });

</script>
</html>
